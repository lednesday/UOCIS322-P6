<!doctype html>
<html lang="en">
   <head>
      <title>Times Displayer</title>
      <meta charset="utf-8">
      <!-- Javascript:  JQuery from a content distribution network (CDN) -->
      <script
         src="https://code.jquery.com/jquery-3.5.1.min.js"
         integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
         crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
         integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
         crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"
         integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF"
         crossorigin="anonymous"></script>
      <link rel="stylesheet" href="../static/display_times.css">
   </head>
   <body>
      <div class="container">
         <h1>Lindsay's Times Displayer</h1>
         <p>You can display all the opening and closing times, or just opening or just closing. Yay.</p>
        <form class="preferences">
            <div class="time_selection">
                <p>Select the times you want</p>
                <input type="radio" id="all" name="times" value="all" checked="checked">
                <label for="all">All opening and closing times</label><br>
                <input type="radio" id="opening" name="times" value="opening">
                <label for="opening">All opening times</label><br>
                <input type="radio" id="closing" name="times" value="closing">
                <label for="closing">All closing times</label>
            </div>
            <div class="format_selection">
                <p>Select the format</p>
                <input type="radio" id="json" name="format" value="json" checked="checked">
                <label for="json">JSON format</label><br>
                <input type="radio" id="csv" name="format" value="csv">
                <label for="csv">CSV format</label><br>
            </div>
            <button id="submit">Submit</button>
        </form>
        <div class="display_times">
        </div>
         
         <script type="text/javascript">
            var SCRIPT_ROOT = {{ request.script_root|tojson|safe }} ;
            var BOTH_URL = SCRIPT_ROOT + "/listeverything";
            var OPEN_URL = SCRIPT_ROOT + "/listopen";
            var CLOSE_URL = SCRIPT_ROOT + "/listclose";
            var BOTH_CSV_URL = SCRIPT_ROOT + "/listeverythingcsv";
            var OPEN_CSV_URL = SCRIPT_ROOT + "/listopencsv";
            var CLOSE_CSV_URL = SCRIPT_ROOT + "/listclosecsv";

            $(document).ready(function(){
                // handler for submit button
                $('#submit').click(
                    function(e){
                        e.preventDefault();
                        var timesValue = $("input[name='times']:checked").val();
                        var formatValue = $("input[name='format]:checked").val();
                        var url_str = "";
                        if(formatValue == "csv"){
                            if(timesValue == "opening"){url_str = OPEN_CSV_URL;}
                            else if(timesValue == "closing"){url_str = CLOSE_CSV_URL;}
                            else{url_str = BOTH_CSV_URL;}
                        }
                        else{
                            if(timesValue == "opening"){url_str = OPEN_URL;}
                            else if(timesValue == "closing"){url_str = CLOSE_URL;}
                            else{url_str = BOTH_URL;}
                        }
                        $.getJSON(url_str, {}, function(api_data){
                            console.log("api_data:", api_data);
                            $(".display_times").val(api_data);
                        });
                    });
                });
         </script>
      </div>
   </body>
</html>
